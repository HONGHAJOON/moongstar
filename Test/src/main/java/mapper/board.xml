<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.board">
	<select id="selectBoard" parameterType="Integer" resultType="dto.FBoard">
		<![CDATA[
			select * from freeboard where freeNum = #{freeNum}
		]]>
	</select>
	<select id="selectBoardList" parameterType="Integer" resultType="dto.FBoard">
		<![CDATA[
			select * from freeboard order by freeNum desc
			limit #{row}, 12 
		]]>
	</select>
	<select id="selectBoardCount" resultType="Integer">
		<![CDATA[
			select count(*) from freeboard
		]]>
	</select>
	<select id="selectBoardListByTag" parameterType="Map" resultType="dto.FBoard">
		<![CDATA[
			select * from freeboard where freeTag=#{freeTag} order by freeNum desc
   			limit #{row}, 12
		]]>
	</select>
	<select id="selectBoardCountByTag" resultType="Integer">
   		<![CDATA[
   			select count(*) from freeboard where freeTag=#{freeTag}
   		]]>
	</select>
	
	<select id="selectBoardListByTagAndSearch" parameterType="Map" resultType="dto.FBoard">
  		SELECT * FROM freeboard
  			<where>
  				<if test="freeTag != null">
    			AND freeTag = #{freeTag}
  				</if>
   				<if test="searchText != null">
    			AND freeSub like '%${searchText}%'
  				</if>
   			</where>
  		order by freeNum desc
   		limit #{row}, 12
	</select>
	
	<select id="selectBoardCountByTagAndSearch" parameterType="Map" resultType="Integer">
  		SELECT count(*) FROM freeboard
  			<where>
  				<if test="freeTag != null">
    			AND freeTag = #{freeTag}
  				</if>
   				<if test="searchText != null">
    			AND freeSub like '%${searchText}%'
  				</if>
  			</where>
	</select>
	

	
	
	<insert id="insertBoard" parameterType="dto.FBoard" useGeneratedKeys="true" keyProperty="freeNum">
		<![CDATA[
			insert into freeboard (freeNick,freeSub,freeContent,freePhoto,freeTag,freeWriteDate)
			values (#{freeNick},#{freeSub}, #{freeContent}, #{freePhoto},#{freeTag},curdate())
		]]>
	</insert>
	
	<update id="updateBoard" parameterType="dto.FBoard">
		update freeboard
		<trim prefix="SET" suffixOverrides=",">
			<if test="freeSub != null">freeSub=#{freeSub},</if>
			<if test="freeContent != null">freeContent=#{freeContent},</if>
			<if test="freePhoto != null">freePhoto=#{freePhoto}</if>
			<if test="freeTag != null">freeTag=#{freeTag}</if>
		</trim>
		where freeNum = #{freeNum}
	</update>
	
	<update id="deleteBoard" parameterType="dto.FBoard">
		<![CDATA[
			update freeboard 
			set freeHidden = true
			where freeNum=#{freeNum}
		]]>
	</update>
	
	<update id="updateBoardViewCount" parameterType="Integer">
		<![CDATA[
		update freeboard set freeView = freeView+1 where freeNum=#{freeNum}
		]]>
	</update>
	
	<select id="selectFreeComment" parameterType="Integer"
		resultType="dto.Comment">
		<![CDATA[
			select * from freeComment where freeNum=#{freeNum}
		]]>
	</select>

	<insert id="insertFreeComment" parameterType="dto.Comment">
		<![CDATA[
			insert into freeComment (commNick,freeNum,commContent,commDate)
			values (#{commNick},#{freeNum},#{commContent},curdate())
		]]>
	</insert>
	
	<select id="selectMemNick" parameterType="String"
		resultType="String">
		<![CDATA[
			select memNick from member where memId=#{memId}
		]]>
	</select>

</mapper>